<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stock Price Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
</head>
<body class="bg-gray-50 min-h-screen">
    <div id="root"></div>

    <script type="text/babel">
        // Stock Dashboard React Component
        const { useState, useEffect } = React;

        // API Service
        const StockAPI = {
            // Using Alpha Vantage API (demo key for illustration)
            async fetchStockData(symbol) {
                try {
                    // In a real implementation, you would use your actual API key
                    const response = await fetch(
                        `https://www.alphavantage.co/query?function=GLOBAL_QUOTE&symbol=${symbol}&apikey=demo`
                    );
                    const data = await response.json();
                    
                    if (data['Global Quote'] && Object.keys(data['Global Quote']).length > 0) {
                        const quote = data['Global Quote'];
                        return {
                            symbol: quote['01. symbol'],
                            price: parseFloat(quote['05. price']).toFixed(2),
                            change: parseFloat(quote['09. change']).toFixed(2),
                            changePercent: quote['10. change percent']
                        };
                    } else if (data['Note']) {
                        throw new Error('API rate limit exceeded. Using demo data.');
                    } else {
                        throw new Error('Invalid symbol or no data returned');
                    }
                } catch (error) {
                    console.error('API Error:', error);
                    // Fallback to demo data if API fails
                    return this.getDemoData(symbol);
                }
            },
            
            getDemoData(symbol) {
                // Demo data for when API limits are reached
                const demoData = {
                    'AAPL': { symbol: 'AAPL', price: '172.35', change: '2.15', changePercent: '1.26%' },
                    'MSFT': { symbol: 'MSFT', price: '328.79', change: '4.32', changePercent: '1.33%' },
                    'GOOGL': { symbol: 'GOOGL', price: '138.21', change: '-0.45', changePercent: '-0.32%' },
                    'AMZN': { symbol: 'AMZN', price: '142.53', change: '1.27', changePercent: '0.90%' },
                    'TSLA': { symbol: 'TSLA', price: '260.72', change: '-5.34', changePercent: '-2.01%' },
                    'META': { symbol: 'META', price: '312.45', change: '3.21', changePercent: '1.04%' },
                    'NFLX': { symbol: 'NFLX', price: '437.42', change: '-2.18', changePercent: '-0.50%' },
                    'NVDA': { symbol: 'NVDA', price: '431.10', change: '12.35', changePercent: '2.95%' }
                };
                
                return demoData[symbol] || { 
                    symbol, 
                    price: (100 + Math.random() * 200).toFixed(2), 
                    change: (Math.random() * 10 - 5).toFixed(2), 
                    changePercent: `${(Math.random() * 4 - 2).toFixed(2)}%` 
                };
            }
        };

        // Components
        function LoadingSpinner() {
            return (
                <div className="flex justify-center items-center py-8">
                    <div className="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"></div>
                </div>
            );
        }

        function ErrorMessage({ message, onRetry }) {
            return (
                <div className="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
                    <p>{message}</p>
                    {onRetry && (
                        <button 
                            onClick={onRetry}
                            className="mt-2 bg-red-600 hover:bg-red-700 text-white px-4 py-1 rounded"
                        >
                            Try Again
                        </button>
                    )}
                </div>
            );
        }

        function StockTable({ stocks, onSort, sortConfig }) {
            const getSortIcon = (field) => {
                if (sortConfig.key !== field) return <i className="fas fa-sort ml-1"></i>;
                if (sortConfig.direction === 'asc') return <i className="fas fa-sort-up ml-1"></i>;
                return <i className="fas fa-sort-down ml-1"></i>;
            };

            return (
                <div className="overflow-x-auto shadow-md rounded-lg">
                    <table className="min-w-full bg-white">
                        <thead className="bg-gray-200">
                            <tr>
                                <th 
                                    className="px-6 py-3 text-left cursor-pointer"
                                    onClick={() => onSort('symbol')}
                                >
                                    Symbol {getSortIcon('symbol')}
                                </th>
                                <th 
                                    className="px-6 py-3 text-left cursor-pointer"
                                    onClick={() => onSort('price')}
                                >
                                    Price {getSortIcon('price')}
                                </th>
                                <th 
                                    className="px-6 py-3 text-left cursor-pointer"
                                    onClick={() => onSort('change')}
                                >
                                    Change {getSortIcon('change')}
                                </th>
                                <th 
                                    className="px-6 py-3 text-left cursor-pointer"
                                    onClick={() => onSort('changePercent')}
                                >
                                    Change % {getSortIcon('changePercent')}
                                </th>
                                <th className="px-6 py-3 text-left">Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {stocks.map((stock, index) => (
                                <tr key={stock.symbol} className={index % 2 === 0 ? 'bg-white' : 'bg-gray-50 hover:bg-gray-100'}>
                                    <td className="px-6 py-4 font-semibold">{stock.symbol}</td>
                                    <td className="px-6 py-4">${stock.price}</td>
                                    <td className={`px-6 py-4 ${stock.change >= 0 ? 'text-green-600' : 'text-red-600'}`}>
                                        {stock.change >= 0 ? '+' : ''}{stock.change}
                                    </td>
                                    <td className={`px-6 py-4 ${stock.changePercent.includes('-') ? 'text-red-600' : 'text-green-600'}`}>
                                        {stock.changePercent}
                                    </td>
                                    <td className="px-6 py-4">
                                        <button 
                                            className="text-red-500 hover:text-red-700"
                                            onClick={() => {
                                                // Remove stock logic would be implemented in parent component
                                                console.log('Remove:', stock.symbol);
                                            }}
                                        >
                                            <i className="fas fa-trash"></i>
                                        </button>
                                    </td>
                                </tr>
                            ))}
                        </tbody>
                    </table>
                </div>
            );
        }

        function SearchBar({ onSearch, disabled }) {
            const [inputValue, setInputValue] = useState('');

            const handleSubmit = (e) => {
                e.preventDefault();
                if (inputValue.trim()) {
                    onSearch(inputValue.trim().toUpperCase());
                    setInputValue('');
                }
            };

            return (
                <div className="mb-6">
                    <form onSubmit={handleSubmit} className="flex">
                        <input 
                            type="text" 
                            value={inputValue}
                            onChange={(e) => setInputValue(e.target.value)}
                            placeholder="Enter stock symbol (e.g., AAPL)" 
                            className="flex-grow px-4 py-2 border border-gray-300 rounded-l focus:outline-none focus:ring-2 focus:ring-blue-500"
                            disabled={disabled}
                        />
                        <button 
                            type="submit"
                            className="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-r disabled:bg-blue-400 disabled:cursor-not-allowed"
                            disabled={disabled || !inputValue.trim()}
                        >
                            <i className="fas fa-search mr-2"></i> Search
                        </button>
                    </form>
                </div>
            );
        }

        function StockChart({ stocks }) {
            const chartRef = React.useRef(null);
            const [chartInstance, setChartInstance] = useState(null);

            useEffect(() => {
                if (stocks.length === 0) return;

                if (chartInstance) {
                    chartInstance.destroy();
                }

                const ctx = chartRef.current.getContext('2d');
                
                // Create gradient for chart
                const gradient = ctx.createLinearGradient(0, 0, 0, 300);
                gradient.addColorStop(0, 'rgba(59, 130, 246, 0.6)');
                gradient.addColorStop(1, 'rgba(59, 130, 246, 0.1)');

                const newChartInstance = new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: stocks.map(stock => stock.symbol),
                        datasets: [
                            {
                                label: 'Stock Price',
                                data: stocks.map(stock => parseFloat(stock.price)),
                                backgroundColor: gradient,
                                borderColor: 'rgba(59, 130, 246, 1)',
                                borderWidth: 2,
                                borderRadius: 5,
                                barPercentage: 0.6,
                            },
                            {
                                label: 'Daily Change',
                                data: stocks.map(stock => parseFloat(stock.change)),
                                type: 'line',
                                borderColor: 'rgba(239, 68, 68, 1)',
                                borderWidth: 2,
                                pointRadius: 4,
                                pointBackgroundColor: 'rgba(239, 68, 68, 1)',
                                fill: false,
                                tension: 0.1
                            }
                        ]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: {
                                position: 'top',
                            },
                            tooltip: {
                                mode: 'index',
                                intersect: false,
                            }
                        },
                        scales: {
                            y: {
                                beginAtZero: false,
                                grid: {
                                    drawBorder: false,
                                }
                            }
                        }
                    }
                });

                setChartInstance(newChartInstance);

                return () => {
                    if (newChartInstance) {
                        newChartInstance.destroy();
                    }
                };
            }, [stocks]);

            return (
                <div className="mt-8 bg-white p-6 rounded-lg shadow">
                    <h2 className="text-xl font-semibold mb-4">Stock Performance</h2>
                    <canvas ref={chartRef} height="300"></canvas>
                </div>
            );
        }

        // Main App Component
        function StockDashboard() {
            const [stocks, setStocks] = useState([]);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);
            const [sortConfig, setSortConfig] = useState({ key: 'symbol', direction: 'asc' });
            const [searching, setSearching] = useState(false);

            useEffect(() => {
                fetchInitialStocks();
            }, []);

            const fetchInitialStocks = async () => {
                try {
                    setLoading(true);
                    setError(null);
                    
                    const symbols = ['AAPL', 'MSFT', 'GOOGL', 'AMZN', 'TSLA'];
                    const stockData = [];
                    
                    for (const symbol of symbols) {
                        const data = await StockAPI.fetchStockData(symbol);
                        stockData.push(data);
                    }
                    
                    setStocks(stockData);
                } catch (error) {
                    setError(error.message);
                } finally {
                    setLoading(false);
                }
            };

            const handleSearch = async (symbol) => {
                try {
                    setSearching(true);
                    setError(null);
                    
                    const data = await StockAPI.fetchStockData(symbol);
                    
                    // Check if stock already exists
                    const exists = stocks.find(stock => stock.symbol === data.symbol);
                    
                    if (!exists) {
                        setStocks(prevStocks => [...prevStocks, data]);
                    } else {
                        setError('Stock already in the list');
                    }
                } catch (error) {
                    setError(error.message);
                } finally {
                    setSearching(false);
                }
            };

            const handleSort = (key) => {
                let direction = 'asc';
                if (sortConfig.key === key && sortConfig.direction === 'asc') {
                    direction = 'desc';
                }
                
                setSortConfig({ key, direction });
                
                const sortedStocks = [...stocks].sort((a, b) => {
                    let valueA = a[key];
                    let valueB = b[key];
                    
                    // Handle numeric values
                    if (key === 'price' || key === 'change') {
                        valueA = parseFloat(valueA);
                        valueB = parseFloat(valueB);
                    } else if (key === 'changePercent') {
                        valueA = parseFloat(valueA);
                        valueB = parseFloat(valueB);
                    }
                    
                    if (valueA < valueB) return direction === 'asc' ? -1 : 1;
                    if (valueA > valueB) return direction === 'asc' ? 1 : -1;
                    return 0;
                });
                
                setStocks(sortedStocks);
            };

            const sortedStocks = React.useMemo(() => {
                if (!sortConfig) return stocks;
                
                return [...stocks].sort((a, b) => {
                    let valueA = a[sortConfig.key];
                    let valueB = b[sortConfig.key];
                    
                    // Handle numeric values
                    if (sortConfig.key === 'price' || sortConfig.key === 'change') {
                        valueA = parseFloat(valueA);
                        valueB = parseFloat(valueB);
                    } else if (sortConfig.key === 'changePercent') {
                        valueA = parseFloat(valueA);
                        valueB = parseFloat(valueB);
                    }
                    
                    if (valueA < valueB) return sortConfig.direction === 'asc' ? -1 : 1;
                    if (valueA > valueB) return sortConfig.direction === 'asc' ? 1 : -1;
                    return 0;
                });
            }, [stocks, sortConfig]);

            return (
                <div className="container mx-auto px-4 py-8">
                    <header className="text-center mb-8">
                        <h1 className="text-3xl font-bold text-gray-800 mb-2">Stock Price Dashboard</h1>
                        <p className="text-gray-600">Real-time stock data and performance tracking</p>
                    </header>
                    
                    <div className="max-w-6xl mx-auto">
                        <SearchBar onSearch={handleSearch} disabled={searching} />
                        
                        {error && (
                            <ErrorMessage 
                                message={error} 
                                onRetry={fetchInitialStocks} 
                            />
                        )}
                        
                        {loading ? (
                            <LoadingSpinner />
                        ) : (
                            <>
                                <div className="bg-white p-6 rounded-lg shadow mb-6">
                                    <h2 className="text-xl font-semibold mb-4">Stock Data</h2>
                                    <StockTable 
                                        stocks={sortedStocks} 
                                        onSort={handleSort}
                                        sortConfig={sortConfig}
                                    />
                                </div>
                                
                                <StockChart stocks={sortedStocks} />
                            </>
                        )}
                    </div>
                    
                    <footer className="mt-12 text-center text-gray-600">
                        <p>Data provided by Alpha Vantage API</p>
                        <p className="text-sm mt-2">
                            
                        </p>
                    </footer>
                </div>
            );
        }

        // Render the app
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<StockDashboard />);
    </script>
</body>
</html>